# é¡¹ç›®ç¼–è¯‘é€ŸæŸ¥è¡¨

> å¿«é€Ÿå‚è€ƒï¼šå¸¸ç”¨ç¼–è¯‘å‘½ä»¤å’Œé€‰é¡¹

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. ç¼–è¯‘æ‰€æœ‰æµ‹è¯•ç¨‹åº
make

# 2. è¿è¡Œæ‰€æœ‰æµ‹è¯•
make run_tests

# 3. æ¸…ç†ç¼–è¯‘äº§ç‰©
make clean
```

## ğŸ“ Makefile å‘½ä»¤

### åŸºæœ¬ç¼–è¯‘
```bash
make                # ç¼–è¯‘æ‰€æœ‰æµ‹è¯•ç¨‹åº
make test_deps      # åªç¼–è¯‘ä¾èµ–åº“æµ‹è¯•
make test_domain    # åªç¼–è¯‘é¢†åŸŸå±‚æµ‹è¯•
make main           # ç¼–è¯‘ä¸»ç¨‹åºï¼ˆéœ€è¦å…ˆåˆ›å»ºsrc/main.cppï¼‰
```

### è¿è¡Œæµ‹è¯•
```bash
make run_tests      # ç¼–è¯‘å¹¶è¿è¡Œæ‰€æœ‰æµ‹è¯•
./test_dependencies # å•ç‹¬è¿è¡Œä¾èµ–åº“æµ‹è¯•
./test_domain       # å•ç‹¬è¿è¡Œé¢†åŸŸå±‚æµ‹è¯•
```

### æ¸…ç†
```bash
make clean          # æ¸…ç†æ‰€æœ‰ç¼–è¯‘äº§ç‰©
```

### ç¼–è¯‘é€‰é¡¹
```bash
make DEBUG=1        # Debugæ¨¡å¼ï¼ˆå¸¦è°ƒè¯•ä¿¡æ¯ï¼Œæ— ä¼˜åŒ–ï¼‰
make HTTPS=1        # å¯ç”¨HTTPSæ”¯æŒï¼ˆéœ€è¦OpenSSLï¼‰
make ZLIB=1         # å¯ç”¨å‹ç¼©æ”¯æŒï¼ˆéœ€è¦zlibï¼‰
make CXX=clang++    # ä½¿ç”¨clang++ç¼–è¯‘å™¨
make -j4            # ä½¿ç”¨4æ ¸å¹¶è¡Œç¼–è¯‘
```

### å®ç”¨å‘½ä»¤
```bash
make help           # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
make info           # æ˜¾ç¤ºç¼–è¯‘é…ç½®
make stats          # æ˜¾ç¤ºé¡¹ç›®ç»Ÿè®¡
make format         # æ ¼å¼åŒ–ä»£ç ï¼ˆéœ€è¦clang-formatï¼‰
make check          # é™æ€åˆ†æï¼ˆéœ€è¦cppcheckï¼‰
```

## ğŸ› ï¸ CMake å‘½ä»¤

### åŸºæœ¬ä½¿ç”¨
```bash
# 1. åˆ›å»ºæ„å»ºç›®å½•
mkdir build && cd build

# 2. é…ç½®é¡¹ç›®
cmake ..

# 3. ç¼–è¯‘
make

# 4. è¿è¡Œæµ‹è¯•
ctest
```

### ç¼–è¯‘æ¨¡å¼
```bash
# Debugæ¨¡å¼
cmake -DCMAKE_BUILD_TYPE=Debug ..

# Releaseæ¨¡å¼
cmake -DCMAKE_BUILD_TYPE=Release ..

# Release + è°ƒè¯•ä¿¡æ¯
cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo ..
```

### å¯é€‰åŠŸèƒ½
```bash
# å¯ç”¨HTTPS
cmake -DENABLE_HTTPS=ON ..

# å¯ç”¨å‹ç¼©
cmake -DENABLE_ZLIB=ON ..

# æ„å»ºæµ‹è¯•ç¨‹åº
cmake -DBUILD_TESTS=ON ..

# æ„å»ºä¸»ç¨‹åºï¼ˆéœ€è¦src/main.cppï¼‰
cmake -DBUILD_MAIN=ON ..
```

### å¤šæ ¸ç¼–è¯‘
```bash
cmake --build . -j4      # ä½¿ç”¨4æ ¸ç¼–è¯‘
make -j4                 # æˆ–ä½¿ç”¨make
```

### å®‰è£…
```bash
sudo make install        # å®‰è£…åˆ°ç³»ç»Ÿ
sudo make uninstall      # ä»ç³»ç»Ÿå¸è½½
```

## ğŸ’» ç›´æ¥ç¼–è¯‘å‘½ä»¤

### ä¾èµ–åº“æµ‹è¯•
```bash
g++ -std=c++17 -I. test_dependencies.cpp -o test_dependencies -pthread
```

### é¢†åŸŸå±‚æµ‹è¯•
```bash
g++ -std=c++17 -I. test_domain.cpp -o test_domain -pthread
```

### ä¸»ç¨‹åºï¼ˆéœ€è¦src/main.cppï¼‰
```bash
g++ -std=c++17 -I. src/main.cpp -o zygl2 -pthread
```

### Debugæ¨¡å¼
```bash
g++ -std=c++17 -I. -g -O0 -Wall -Wextra test_dependencies.cpp -o test_dependencies -pthread
```

### Releaseæ¨¡å¼
```bash
g++ -std=c++17 -I. -O3 -DNDEBUG -Wall test_dependencies.cpp -o test_dependencies -pthread
```

### å¯ç”¨HTTPS
```bash
g++ -std=c++17 -I. -DCPPHTTPLIB_OPENSSL_SUPPORT \
    test_dependencies.cpp -o test_dependencies \
    -pthread -lssl -lcrypto
```

## ğŸ”§ å¸¸ç”¨ç»„åˆ

### å¼€å‘è°ƒè¯•
```bash
make DEBUG=1            # Debugæ¨¡å¼ç¼–è¯‘
make run_tests          # è¿è¡Œæµ‹è¯•
make clean && make      # æ¸…ç†åé‡æ–°ç¼–è¯‘
```

### æ€§èƒ½æµ‹è¯•
```bash
make -j4                           # å¤šæ ¸ç¼–è¯‘
make CXXFLAGS="-O3 -march=native"  # æœ€é«˜ä¼˜åŒ–+CPUä¼˜åŒ–
```

### å®Œæ•´åŠŸèƒ½
```bash
make HTTPS=1 ZLIB=1 -j4    # HTTPS + å‹ç¼© + å¤šæ ¸ç¼–è¯‘
```

### ä½¿ç”¨ä¸åŒç¼–è¯‘å™¨
```bash
make CXX=clang++           # ä½¿ç”¨clang++
make CXX=g++-13            # ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„g++
```

## ğŸ› è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ç¼–è¯‘ç»†èŠ‚
```bash
make -n                    # æ˜¾ç¤ºå°†æ‰§è¡Œçš„å‘½ä»¤ï¼ˆä¸å®é™…æ‰§è¡Œï¼‰
make VERBOSE=1             # CMakeï¼šæ˜¾ç¤ºè¯¦ç»†ç¼–è¯‘ä¿¡æ¯
```

### å•æ–‡ä»¶æµ‹è¯•
```bash
g++ -std=c++17 -I. -fsyntax-only test_domain.cpp  # åªæ£€æŸ¥è¯­æ³•
g++ -std=c++17 -I. -E test_domain.cpp > output.i   # é¢„å¤„ç†è¾“å‡º
```

### æŸ¥çœ‹ç¬¦å·
```bash
nm test_dependencies       # æŸ¥çœ‹ç¬¦å·è¡¨
ldd test_dependencies      # æŸ¥çœ‹ä¾èµ–åº“ï¼ˆLinuxï¼‰
otool -L test_dependencies # æŸ¥çœ‹ä¾èµ–åº“ï¼ˆmacOSï¼‰
```

## â“ å¸¸è§é—®é¢˜

### Q: æ‰¾ä¸åˆ°å¤´æ–‡ä»¶
```bash
# ç¡®ä¿ä½¿ç”¨ -I. åŒ…å«å½“å‰ç›®å½•
g++ -std=c++17 -I. your_source.cpp -o your_program -pthread
```

### Q: pthreadé“¾æ¥é”™è¯¯
```bash
# æ·»åŠ  -pthread
g++ -std=c++17 -I. your_source.cpp -o your_program -pthread
```

### Q: C++17ç‰¹æ€§ä¸æ”¯æŒ
```bash
# ç¡®ä¿ä½¿ç”¨ -std=c++17
g++ -std=c++17 ...

# æˆ–å‡çº§ç¼–è¯‘å™¨
# GCC: sudo apt install g++-11
# Clang: brew install llvm
```

### Q: OpenSSLé“¾æ¥é”™è¯¯
```bash
# macOS: å®‰è£…OpenSSL
brew install openssl

# Ubuntu: å®‰è£…OpenSSL
sudo apt install libssl-dev

# ç¼–è¯‘æ—¶é“¾æ¥
g++ ... -DCPPHTTPLIB_OPENSSL_SUPPORT -lssl -lcrypto
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ç¼–è¯‘é€Ÿåº¦ä¼˜åŒ–
```bash
# 1. å¤šæ ¸ç¼–è¯‘
make -j$(nproc)          # Linux
make -j$(sysctl -n hw.ncpu)  # macOS

# 2. ä½¿ç”¨ccache
export CXX="ccache g++"
make

# 3. ä½¿ç”¨é¢„ç¼–è¯‘å¤´
g++ -std=c++17 -I. pch.h  # é¢„ç¼–è¯‘å¤´æ–‡ä»¶
```

### è¿è¡Œæ—¶ä¼˜åŒ–
```bash
# æœ€é«˜ä¼˜åŒ–çº§åˆ«
make CXXFLAGS="-O3 -march=native -flto"

# å¼€å¯é“¾æ¥æ—¶ä¼˜åŒ–
g++ -std=c++17 -I. -O3 -flto your_source.cpp -o your_program
```

## ğŸ“š æ›´å¤šä¿¡æ¯

- **å®Œæ•´æ–‡æ¡£**: `cat ç¼–è¯‘æŒ‡å—.md`
- **Makefileå¸®åŠ©**: `make help`
- **CMakeé…ç½®**: æŸ¥çœ‹ `CMakeLists.txt`
- **ä¾èµ–åº“æ–‡æ¡£**: `cat third_party/README.md`

## ğŸ¯ æ¨èå·¥ä½œæµ

### æ–¹æ¡ˆ1ï¼šçº¯Makefileï¼ˆæœ€ç®€å•ï¼‰
```bash
make                # ç¼–è¯‘
make run_tests      # æµ‹è¯•
make clean          # æ¸…ç†
```

### æ–¹æ¡ˆ2ï¼šCMakeï¼ˆè·¨å¹³å°ï¼‰
```bash
mkdir build && cd build
cmake -DCMAKE_BUILD_TYPE=Release ..
make -j4
ctest
```

### æ–¹æ¡ˆ3ï¼šå¼€å‘æ¨¡å¼ï¼ˆå¿«é€Ÿè¿­ä»£ï¼‰
```bash
# Debugæ¨¡å¼ï¼Œå¿«é€Ÿç¼–è¯‘
make DEBUG=1

# ä¿®æ”¹ä»£ç åé‡æ–°ç¼–è¯‘
make clean && make DEBUG=1

# è¿è¡Œæµ‹è¯•
make run_tests
```

---

**æç¤º**: ä½¿ç”¨ `make help` æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤

