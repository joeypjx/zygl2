# 项目目录结构

## 概述

本项目采用DDD（领域驱动设计）分层架构，代码和文档组织清晰，便于维护和扩展。

## 目录结构

```
zygl2/                                    # 项目根目录
├── README.md                             # 项目说明（主文档）
├── 项目目录结构.md                        # 本文件
│
├── docs/                                 # 📚 文档目录
│   ├── 项目实现总结.md                    # 整体实现总结
│   ├── 领域层实现总结.md                  # Domain层详细文档
│   ├── 基础设施层实现总结.md              # Infrastructure层详细文档
│   ├── 应用层实现总结.md                  # Application层详细文档
│   ├── 接口层实现总结.md                  # Interfaces层详细文档
│   ├── 领域层实现完成.md                  # 领域层完成报告
│   ├── Git使用指南.md                     # Git操作手册
│   └── GitHub推送指南.md                  # GitHub推送说明
│
├── src/                                  # 💻 源代码目录
│   ├── domain/                           # 领域层（Domain Layer）
│   │   ├── README.md                     # 领域层设计文档
│   │   ├── domain.h                      # 领域层统一头文件
│   │   ├── value_objects.h               # 值对象定义
│   │   ├── board.h                       # 板卡实体
│   │   ├── chassis.h                     # 机箱聚合根
│   │   ├── task.h                        # 任务实体
│   │   ├── service.h                     # 组件实体
│   │   ├── stack.h                       # 业务链路聚合根
│   │   ├── alert.h                       # 告警聚合根
│   │   ├── i_chassis_repository.h        # 机箱仓储接口
│   │   ├── i_stack_repository.h          # 业务链路仓储接口
│   │   └── i_alert_repository.h          # 告警仓储接口
│   │
│   ├── infrastructure/                   # 基础设施层（Infrastructure Layer）
│   │   ├── README.md                     # 基础设施层设计文档
│   │   ├── infrastructure.h              # 基础设施层统一头文件
│   │   ├── persistence/                  # 持久化实现
│   │   │   ├── in_memory_chassis_repository.h      # 机箱仓储实现（双缓冲）
│   │   │   ├── in_memory_stack_repository.h        # 业务链路仓储实现
│   │   │   └── in_memory_alert_repository.h        # 告警仓储实现
│   │   ├── api_client/                   # API客户端
│   │   │   └── qyw_api_client.h          # HTTP API客户端
│   │   ├── collectors/                   # 数据采集
│   │   │   └── data_collector_service.h  # 后台数据采集服务
│   │   └── config/                       # 配置管理
│   │       └── chassis_factory.h         # 机箱配置工厂
│   │
│   ├── application/                      # 应用层（Application Layer）
│   │   ├── README.md                     # 应用层设计文档
│   │   ├── application.h                 # 应用层统一头文件
│   │   ├── dtos/                         # 数据传输对象
│   │   │   └── dtos.h                    # DTOs定义
│   │   └── services/                     # 应用服务
│   │       ├── monitoring_service.h      # 监控服务
│   │       ├── stack_control_service.h   # 业务控制服务
│   │       └── alert_service.h           # 告警服务
│   │
│   └── interfaces/                       # 接口层（Interfaces Layer）
│       ├── README.md                     # 接口层设计文档
│       ├── interfaces.h                  # 接口层统一头文件
│       ├── udp/                          # UDP通信
│       │   ├── udp_protocol.h            # UDP协议定义
│       │   ├── state_broadcaster.h       # 状态广播器
│       │   └── command_listener.h        # 命令监听器
│       └── http/                         # HTTP通信
│           └── webhook_listener.h        # Webhook监听器
│
├── test_domain.cpp                       # 测试文件
├── Dialog.txt                            # 设计讨论记录
├── Server_API.txt                        # 后端API接口文档
├── .gitignore                            # Git忽略规则
└── .gitattributes                        # Git文件属性
```

## 目录说明

### 📁 根目录文件

| 文件名 | 说明 |
|--------|------|
| README.md | 项目主文档，包含项目简介、技术栈、快速开始等 |
| 项目目录结构.md | 本文件，详细的目录结构说明 |
| Dialog.txt | 项目设计过程中的讨论记录 |
| Server_API.txt | 后端API接口规范文档 |
| test_domain.cpp | 领域层功能测试代码 |

### 📚 docs/ 文档目录

| 文件名 | 说明 | 行数 |
|--------|------|------|
| 项目实现总结.md | 整个项目的总体实现总结和统计 | ~800行 |
| 领域层实现总结.md | Domain层的详细实现说明 | ~700行 |
| 基础设施层实现总结.md | Infrastructure层的详细实现说明 | ~600行 |
| 应用层实现总结.md | Application层的详细实现说明 | ~476行 |
| 接口层实现总结.md | Interfaces层的详细实现说明 | ~500行 |
| 领域层实现完成.md | 领域层完成时的总结报告 | ~200行 |
| Git使用指南.md | Git版本控制完整操作手册 | ~575行 |
| GitHub推送指南.md | GitHub推送和认证详细说明 | ~372行 |

### 💻 src/ 源代码目录

#### 🏛️ domain/ 领域层（1,963行代码）

**职责**：封装核心业务逻辑和业务规则

**核心组件**：
- 3个聚合根：Chassis、Stack、Alert
- 3个实体：Board、Service、Task
- 多个值对象：TaskStatusInfo、ResourceUsage等
- 3个仓储接口

**技术特点**：
- 零外部依赖
- 固定大小数据结构
- 内存对齐优化
- 完整的业务规则实现

#### 🔧 infrastructure/ 基础设施层（1,678行代码）

**职责**：提供技术基础设施和外部系统集成

**核心组件**：
- 3个内存仓储实现（双缓冲 + 读写锁）
- HTTP API客户端
- 后台数据采集服务
- 配置工厂

**技术特点**：
- 双缓冲无锁读取
- 读写锁并发控制
- ACL防腐层
- 依赖cpp-httplib和nlohmann/json

#### 📋 application/ 应用层（1,296行代码）

**职责**：协调领域对象完成业务用例

**核心组件**：
- 3个应用服务（监控、控制、告警）
- 15+个DTOs
- 统一响应格式
- 服务工厂

**技术特点**：
- DTOs防止领域泄露
- 依赖注入
- 统一错误处理
- 方案B按需查询

#### 🌐 interfaces/ 接口层（1,247行代码）

**职责**：处理所有外部通信

**核心组件**：
- UDP协议定义
- UDP状态广播器
- UDP命令监听器
- HTTP Webhook监听器

**技术特点**：
- UDP多播通信
- 固定大小数据包
- 命令反馈机制
- RESTful API

## 代码统计

| 层级 | 文件数 | 代码行数 | 完成度 |
|------|--------|----------|--------|
| Domain层 | 11 | 1,963 | ✅ 100% |
| Infrastructure层 | 7 | 1,678 | ✅ 100% |
| Application层 | 5 | 1,296 | ✅ 100% |
| Interfaces层 | 5 | 1,247 | ✅ 100% |
| **总计** | **28** | **6,184** | **✅ 100%** |

## 文档统计

- **文档文件数**：11个
- **总文档行数**：约4,000行
- **文档完整度**：100%

## 命名规范

### 目录命名
- 源代码目录：小写英文（domain, infrastructure等）
- 文档目录：中文（docs/）

### 文件命名
- 头文件：小写英文 + 下划线（snake_case）
  - 例：`in_memory_chassis_repository.h`
- 文档文件：中文描述性名称
  - 例：`领域层实现总结.md`
- 特殊文件：保持标准命名
  - README.md（GitHub标准）
  - .gitignore、.gitattributes

### 代码命名
- 命名空间：`zygl::<layer>`
  - 例：`zygl::domain`、`zygl::application`
- 类名：PascalCase
  - 例：`Chassis`、`InMemoryChassisRepository`
- 成员变量：m_前缀 + camelCase
  - 例：`m_boardNumber`、`m_chassisRepo`
- 常量：大写 + 下划线
  - 例：`MAX_TASKS_PER_BOARD`

## 架构层次

```
┌─────────────────────────────────────┐
│  Interfaces Layer (接口层)          │  ← UDP + HTTP
│  src/interfaces/                    │
├─────────────────────────────────────┤
│  Application Layer (应用层)         │  ← 业务用例
│  src/application/                   │
├─────────────────────────────────────┤
│  Infrastructure Layer (基础设施层)  │  ← 技术基础
│  src/infrastructure/                │
├─────────────────────────────────────┤
│  Domain Layer (领域层)              │  ← 核心业务
│  src/domain/                        │
└─────────────────────────────────────┘
```

## 依赖关系

### 外部依赖
- **cpp-httplib**：HTTP通信库（header-only）
- **nlohmann/json**：JSON解析库（header-only）
- **C++17标准库**

### 内部依赖方向
```
Interfaces → Application → Infrastructure → Domain
     ↑            ↑              ↑
     └────────────┴──────────────┘
         (只能向下依赖)
```

## 文件组织原则

1. **单一职责**：每个文件只负责一个类或一组相关的定义
2. **头文件优先**：采用header-only设计，便于集成
3. **统一头文件**：每层提供统一头文件（domain.h等）
4. **文档就近**：每层的README.md放在对应目录
5. **中文文档**：实现总结和指南使用中文，便于理解

## 扩展指南

### 添加新的领域实体
```
src/domain/new_entity.h         # 新实体定义
docs/领域层实现总结.md            # 更新文档
```

### 添加新的应用服务
```
src/application/services/new_service.h    # 新服务
docs/应用层实现总结.md                     # 更新文档
```

### 添加新的通信协议
```
src/interfaces/protocol/new_protocol.h    # 新协议
docs/接口层实现总结.md                     # 更新文档
```

## 维护建议

1. **保持文档同步**：代码更改后及时更新相关文档
2. **遵循命名规范**：新增文件遵循现有命名规范
3. **更新统计信息**：定期更新代码行数等统计数据
4. **版本管理**：使用Git进行版本控制，遵循提交规范

## 快速导航

- **了解项目**：阅读根目录的 `README.md`
- **查看总结**：阅读 `docs/项目实现总结.md`
- **学习某层**：阅读对应的 `src/<layer>/README.md`
- **查看实现**：阅读 `docs/<layer>实现总结.md`
- **Git操作**：参考 `docs/Git使用指南.md`
- **推送代码**：参考 `docs/GitHub推送指南.md`

---

**最后更新**：2025-10-26  
**项目状态**：核心架构已完成  
**文档完整度**：✅ 100%

